<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Snake Chaos</title>
<style>
  body {
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }
  canvas {
    background: #111;
    box-shadow: 0 0 20px #0f0;
    border: 3px solid #0f0;
  }
  #score {
    position: absolute;
    top: 20px;
    font-size: 28px;
    font-family: Arial, sans-serif;
    color: #0f0;
  }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<canvas id="game" width="400" height="400"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const grid = 20;
let snake = [{x: 200, y: 200}];
let dx = grid, dy = 0;
let apples = [{x: randomPos(), y: randomPos()}];
let score = 0;
let autoPlay = false;
let eaten = 0;

function randomPos() {
  return Math.floor(Math.random() * (canvas.width / grid)) * grid;
}

function drawSnake() {
  ctx.fillStyle = '#0f0';
  snake.forEach(s => ctx.fillRect(s.x, s.y, grid, grid));
}

function drawApples() {
  ctx.fillStyle = 'red';
  apples.forEach(a => ctx.fillRect(a.x, a.y, grid, grid));
}

function update() {
  const head = {x: snake[0].x + dx, y: snake[0].y + dy};
  snake.unshift(head);

  // Check apple collision
  for (let i = apples.length - 1; i >= 0; i--) {
    if (head.x === apples[i].x && head.y === apples[i].y) {
      apples.splice(i,1);
      score += 10;
      eaten++;
      flashBackground();
      spawnApples();
      if (eaten === 3) autoPlay = true;
    }
  }

  if (!apples.some(a => a.x === head.x && a.y === head.y)) snake.pop();

  // Collision detection
  if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height ||
      snake.slice(1).some(s => s.x === head.x && s.y === head.y)) {
    alert('Game Over! Score: ' + score);
    document.location.reload();
  }

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawSnake();
  drawApples();
  scoreEl.textContent = 'Score: ' + score;
}

function flashBackground() {
  let colors = ['#ff0000','#00ff00','#0000ff','#ffff00','#ff00ff','#00ffff','#ffffff'];
  let flashes = 0;
  const interval = setInterval(()=>{
    document.body.style.background = colors[Math.floor(Math.random()*colors.length)];
    flashes++;
    if (flashes > 10) {
      clearInterval(interval);
      document.body.style.background = '#000';
    }
  },50);
}

function spawnApples() {
  apples.push({x: randomPos(), y: randomPos()});
  if (eaten % 4 === 0) { // chaos multiplier
    for (let i=0;i<3;i++) apples.push({x: randomPos(), y: randomPos()});
  }
}

document.addEventListener('keydown', e => {
  if (autoPlay) return; // ignore controls during auto
  if (e.key === 'ArrowLeft' && dx === 0) {dx = -grid; dy = 0;}
  else if (e.key === 'ArrowUp' && dy === 0) {dx = 0; dy = -grid;}
  else if (e.key === 'ArrowRight' && dx === 0) {dx = grid; dy = 0;}
  else if (e.key === 'ArrowDown' && dy === 0) {dx = 0; dy = grid;}
});

// Simple autopilot to chase nearest apple
function autoMove() {
  if (!autoPlay || apples.length === 0) return;
  let target = apples[0];
  let head = snake[0];
  if (head.x < target.x && dx === 0) {dx = grid; dy = 0;}
  else if (head.x > target.x && dx === 0) {dx = -grid; dy = 0;}
  else if (head.y < target.y && dy === 0) {dx = 0; dy = grid;}
  else if (head.y > target.y && dy === 0) {dx = 0; dy = -grid;}
}

function loop() {
  autoMove();
  update();
}
setInterval(loop, 100);
</script>
</body>
</html>
